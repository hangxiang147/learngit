<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="s" uri="/struts-tags" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %> 
<!DOCTYPE html> 
<html lang="zh-CN">
<head>
<script src="/assets/js/layer/layer.js"></script>
<script src="assets/js/jquery.table2excel.js"></script>
<script type="text/javascript">
	$(function () {
		set_href();
		var flag = $("#flag").val();
		$("#myTab li a").each(function(i, obj) {
			if (i+1 == flag) {
				$(obj).tab("show");
			}
			$(obj).click(function(e) {
				e.preventDefault();
				window.location.href = "workReport/findWeekReportStatistics?flag="+(i+1)+"&companyID="+$(obj).attr("href").substring(1);
			});
		});
	});
	function checkDays(id){
		var beginDate = $("#beginDate"+id).val();
		var endDate = $("#endDate"+id).val();
		if(beginDate=="" || endDate==""){
			return false;
		}
		var days = (new Date(endDate.replace(/-/g, "/")).getTime() - new Date(beginDate.replace(/-/g, "/")).getTime())/(24*60*60*1000);
		if(days>7){
			layer.alert("查询间隔时间不能大于一个星期！",{offset:'100px'});
			return false;
		}
	}
</script>

<style type="text/css">
	.form-group {
	    margin-bottom: 30px;
	    margin-top: 30px;
	}
	
	.detail-control {
		display: block;
	    width: 100%;
	    height: 34px;
	    padding: 6px 12px;
	    font-size: 14px;
	    line-height: 1.42857143;
	    color: #555;
	}
	.tableuser{border:1px solid #ddd;border-spacing:0;border-collapse:collapse;width:880px;color:#555555;}
	.tableuser tr{display:table-row;vertical-align:inherit;border-color:inherit;}
	.tableuser tr td{border:1px solid #ddd;height:34px;line-height:34px;padding:10px 10px;}
</style>
</head>
<body>
	<div class="container-fluid">
      <div class="row">
       <s:set name="panel" value="'workReport'"></s:set>
        <%@include file="/pages/PM/panel.jsp" %>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        	<input type="hidden" id="flag" value="${flag}" />
        	<ul class="nav nav-tabs" role="tablist" id="myTab">
        		<c:if test="${not empty companyVOs }">
	        	<c:forEach items="${companyVOs }" var="companyVO" varStatus="st">
	        		<li role="presentation"><a href="#${companyVO.companyID}" role="tab" data-toggle="tab">${companyVO.companyName}</a></li>
	        	</c:forEach>
	        	</c:if>
        	</ul>
        	
        	<div class="tab-content">
        		<c:if test="${not empty companyVOs }">
	        	<c:forEach items="${companyVOs }" var="companyVO" varStatus="st">
	        		<div role="tabpanel" class="tab-pane" id="${companyVO.companyID }">
	        		<form action="workReport/findWeekReportStatistics" method="post" onsubmit="return checkDays(${companyVO.companyID})">
					
					    <input type="hidden" name="flag" value="${companyVO.companyID }" />
					    <input type="hidden" name="companyID" value="${companyVO.companyID }"/>
					    <div class="form-group">
						<label for="beginDate" class="col-sm-1 control-label" style="text-align:right">周日期：</label>
						    <div class="col-sm-2">
						    	<input type="text" class="form-control"  id="beginDate${companyVO.companyID}" name="beginDate" value="${beginDate}" required autoComplete="off"
						    	 onclick="WdatePicker({ dateFmt: 'yyyy-MM-dd', maxDate:'#F{$dp.$D(\'endDate${companyVO.companyID}\')}'})">
						    </div>
						    <div class="col-sm-1 control-label" style="width:5px">至</div>
						    <div class="col-sm-2">
						    	<input type="text" class="form-control"  id="endDate${companyVO.companyID}" name="endDate" value="${endDate}" required autoComplete="off"
						    	 onclick="WdatePicker({ dateFmt: 'yyyy-MM-dd', minDate:'#F{$dp.$D(\'beginDate${companyVO.companyID}\')}' })">
						    </div>
					    <button type="submit" id="submitButton" class="btn btn-primary">查询</button> 
						</div>
					</form>	        		
	        			<div class="table-responsive" style="margin-top:30px;">
	        				<table class="tableuser">
							 	<tbody>
							 	  <tr>
							 	    <c:choose>
							 	    <c:when test="${not empty beginDate }">
							 	    <td width="18%" align="center" >未汇报人数：</td>
							 	    </c:when>
							 	    <c:otherwise> 
								   	<td width="18%" align="center">上周未汇报人数：</td>
								   	</c:otherwise> 
								   	</c:choose>
								    <td width="70%">${count}人</td>
								  </tr>
								  <tr>
								    <td align="center">人员明细：</td>
								    <td colspan="2">
								    <c:forEach items="${weekReportVos }" var="weekReportVo" varStatus="st">
								    	${weekReportVo.userName }（<c:forEach items="${weekReportVo.groupList }" var="group" varStatus="st"><c:if test="${st.index != 0 }">；</c:if>${group}</c:forEach>）<br>
								    </c:forEach>
								    </td>
								  </tr>
								</tbody>
							</table>
	        			</div>
	        		</div>
	        	</c:forEach>
	        	</c:if>
        	</div>
        	
        </div>
      </div>
    </div>
</body>
</html>