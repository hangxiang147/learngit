<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="s" uri="/struts-tags" %>
<!DOCTYPE html> 
<html lang="zh-CN">
<head>
<link href="/assets/css/base.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/global.css" rel="stylesheet" type="text/css" />
<link href="/assets/js/layer/skin/default/layer.css" rel='stylesheet'/>
<script src="/assets/js/layer/layer.js"></script>

<script type="text/javascript">

	var confirmRight=function(id){
		layer.confirm("是否确认有效？",{offset:'100px'},function (){
			$.ajax({
				url:'/personal/confirmSalary',
				data:{id:id},
				success:function (result){
					location.reload();
				}
			})
		},function (){
			layer.closeAll();
		})
	};

	var tcyy=function (id){
		layer.prompt({title: '请指出有问题的地方', formType: 3,offset:'100px'},function (content,index){
			layer.close(index);
			$.ajax({
				url:'/personal/againestSalary',
				data:{id:id,content:content},
				type:'post',
				dataType:'json',
				success:function (result){
					if(result.success=="1"){
						layer.alert("修改成功",{offset:'100px'},function(){
							location.reload();
						})
					}else{
						layer.alert("修改失败",{offset:'100px'})
					}
				}
			})
		});
	}
	$(function() {
		$('#cheakModal').on('hide.bs.modal', function () {
			window.location.reload();
		});
		
		if($("#hasSignin").val()==1){
			$("#signinButton").text("今日已签到");
			$("#signinButton").removeAttr("href");
			$("#signinButton").removeAttr("onclick");
			$("#signinButton").attr("class", "icon_signIn_selected");
		}
	});

	function readMessage(ntcID, userID) {
		$.ajax({
			url:'personal/updateNoticeActor',
	        type:'post',
	        data:{ntcID:ntcID,userID:userID},
	        dataType:'json',
	        success:function(data){
	        	if (data.errorMessage!=null && data.errorMessage.length!=0) {
					alert("操作失败");
					return;
				}
	        	
	        	$("#exampleModalLabel").html(data.noticeVO.ntcTitle);
	        	$("#ntcContent").html(data.noticeVO.ntcContent.replace(/\n/g, "<br/>").replace(/\s/g, "&nbsp;"));
	        	if(data.noticeVO.ntcTitle!="快递领取通知"){
	        		$("#zhu").parent().remove();
	        	}
	        	$("#cheakModal").modal('show');
	        }
			
		});
	}	
	var Add=function (value){
		if(/.*\+.*/.test(value+"")){
			try{
				value=eval(value);
			}catch(ignore){
			}
		}
		return value;
	}
	var prevArray=["部门","姓名","基础工资","绩效奖金","绩效提成","补贴","满勤","应抵扣金额","其他扣除","迟到扣除","扣养老","扣医保","扣失业","大病","扣住房公积金","扣个税","实发工资"];
	function showSalary (detail,key,year,month,deptName,userName){
		var detail=detail.match(/\[(.*)\]\s*/)[1].split(",");
		$("#exampleModalLabel").html(year+"年"+month+"月 工资详情");
		var resultContent=[];
		prevArray.forEach(function (value,index){
			if(index>1){
				resultContent.push(prevArray[index]+":"+Add(detail[index-2]))
			}else{
				if(index==0){
					resultContent.push(prevArray[index]+":"+deptName);
				}else{
					resultContent.push(prevArray[index]+":"+userName);
				}
			}
		})
    	$("#ntcContent").html(resultContent.join("</br>"));
    	$("#zhu").parent().remove();
    	$("#cheakModal").modal('show');
	}
	function getNotice(ntcID) {
		$.ajax({
			url:'administration/notice/getNoticeByntcID',
	        type:'post',
	        data:{ntcID:ntcID},
	        dataType:'json',
	        success:function(data){
	        	if (data.errorMessage!=null && data.errorMessage.length!=0) {
					alert("操作失败");
					return;
				}
	        	
	        	$("#exampleModalLabel").html(data.noticeVO.ntcTitle);
	        	$("#ntcContent").html(data.noticeVO.ntcContent.replace(/\n/g,"<br/>").replace(/\s/g, "&nbsp;"));
	        	var attachments = '';
	        	data.attachments.forEach(function(value, index){
	        		attachments += "<a href='administration/notice/download?attachmentPath="+value.softURL+"&attachmentName="+value.softName+"'>"+value.softName+"</a>";
	        	});
	        	$("#attachments").html(attachments);
	        	$("#zhu").parent().remove();
	        	$("#cheakModal").modal('show');
	        	
	        }
			
		});
	}
	
	function signin() {
		$.ajax({
			url:'signin/signin',
			type:'post',
			data:{},
			dataType:'json',
			success:function (data){
				if (data.errorMessage!=null && data.errorMessage.length!=0) {
					alert(data.errorMessage);
				} else {
					alert("签到成功！");
				}
				$("#signinButton").text("今日已签到");
				$("#signinButton").removeAttr("href");
				$("#signinButton").removeAttr("onclick");
				$("#signinButton").attr("class", "icon_signIn_selected");
			}
		});
	}

</script>
<style type="text/css">
	.modal-body p {margin:0 0 10;}
	.modal-body h4 {margin-top:10px; margin-bottom:10px;}
</style>
</head>
<body>
	<div class="container-fluid">
      <div class="row">
        <%@include file="/pages/personal/panel.jsp" %>	
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        	<div class="shortcut_link"></div>
        	<div class="index_link">
			<ul>
			<li><a href="personal/showVacationDiagram" class="icon_holiday">请假申请</a></li>
			<li><a href="personal/workReportDetail" class="icon_job">工作汇报</a></li>
			<li><a href="javascript:void(0);" class="icon_signIn_default" id="signinButton" onclick="signin()">未签到</a><input type="hidden" id="hasSignin" value="${hasSignin }" /></li>
			</ul>
			</div>
			<div class="blank20"></div>
			<div class="index_column_wrap clearfix">
			<div class="index_column">
			<h1>最新公告<a href="information/notice/findNoticeList1" class="fr" style="color:#888;font-size:14px;">更多>></a></h1>
			<!-- <div class="cont">
			<p>征集全国科普工作先进集体和先进工作者的通知征集全国科普工作先进集体和先进工作者的通知征集全国科普工作先进集体和先进工作者的通知</p>
			</div> -->
			<ul>
			<c:if test="${not empty noticeVOs }">
			<s:iterator id="noticeVO" value="#request.noticeVOs" status="count">
				<li><a href="javascript:void(0)" title="<s:property value="#noticeVO.ntcTitle"/>" onclick="getNotice(<s:property value='#noticeVO.ntcID'/>)" ><s:if test="#noticeVO.isTop==1">【置顶】</s:if><s:if test="#noticeVO.ntcTitle.length() > 12"><s:property value="#noticeVO.ntcTitle.substring(0, 12)"/></s:if><s:else><s:property value="#noticeVO.ntcTitle"/></s:else></a><span><s:property value="#noticeVO.noticeDate"/></span></li>
			</s:iterator>
			</c:if>
			<c:if test="${empty noticeVOs }">
				<li>暂无</li>
			</c:if>
			</ul>
			</div>
			
			<div class="index_column">
			<h1>最新消息<a href="personal/findNoticeList" class="fr" style="color:#888;font-size:14px;">更多>></a></h1>
			<ul>
			<c:if test="${not empty messageVOs }">
			<s:iterator id="messageVO" value="#request.messageVOs" status="count">
				<li><a href="javascript:void(0)" title="<s:property value="#messageVO.ntcTitle"/>" onclick="readMessage(<s:property value='#messageVO.ntcID'/>, '<s:property value="#messageVO.userID"/>')" <s:if test="#messageVO.status==0">style="color:#f24451;"</s:if>><s:if test="#messageVO.ntcTitle.length() > 16"><s:property value="#messageVO.ntcTitle.substring(0, 16)"/></s:if><s:else><s:property value="#messageVO.ntcTitle"/></s:else></a><span><s:property value="#messageVO.noticeDate"/></span></li>
			</s:iterator>
			</c:if>
			<c:if test="${empty messageVOs }">
				<li>暂无</li>
			</c:if>
			</ul>
			</div>
			<div class="index_column">
			<h1>待办列表<a href="personal/findTaskList?type=1" class="fr" style="color:#888;font-size:14px;">更多>></a></h1>
			<ul>
			<c:if test="${not empty taskVOs }">
			<s:iterator id="taskVO" value="#request.taskVOs" status="count">
				<li><a title="<s:property value="#taskVO.title"/>" href="<s:if test="#taskVO.businessKey == 'Vacation'">personal/findTaskList?type=1</s:if>
				             <s:if test="#taskVO.businessKey == 'Assignment'">personal/findTaskList?type=2</s:if>
				             <s:if test="#taskVO.businessKey == 'Resignation'">personal/findTaskList?type=3</s:if>
				             <s:if test="#taskVO.businessKey == 'Formal'">personal/findTaskList?type=4</s:if>
				             <s:if test="#taskVO.businessKey == 'Reimbursement'">personal/findTaskList?type=5</s:if>
				             <s:if test="#taskVO.businessKey == 'Email'">personal/findTaskList?type=6</s:if>
				             <s:if test="#taskVO.businessKey == 'Audit'">personal/findTaskList?type=8</s:if>
				             <s:if test="#taskVO.businessKey == 'SocialSecurity'">personal/findTaskList?type=9</s:if>"><s:if test="#taskVO.title.length() > 16"><s:property value="#taskVO.title.substring(0, 16)"/></s:if><s:else><s:property value="#taskVO.title"/></s:else></a><span><s:property value="#taskVO.requestDate"/></span></li>
			</s:iterator>
			</c:if>
			<c:if test="${empty taskVOs }">
				<li>暂无</li>
			</c:if>
			</ul>
			</div>
			<div class="index_column">
			<h1>岗位职责<a href="personal/findGroupDetails" class="fr" style="color:#888;font-size:14px;">更多>></a></h1>
			<ul>
			<c:if test="${not empty groupDetailVOs }">
			<s:iterator id="groupDetailVO" value="#request.groupDetailVOs" status="count">
				<li><a href="personal/findGroupDetails"><s:property value="#groupDetailVO.companyName"/>-<s:property value="#groupDetailVO.departmentName"/>-<s:property value="#groupDetailVO.positionName"/></a></li>
			</s:iterator>
			</c:if>
			</ul>
			</div>
			
			
			<div class="index_column">
			<h1>历史工资</h1>
			<ul>
			<c:if test="${not empty softGroupEntities }">
			<s:iterator id="softGroupEntity" value="#request.softGroupEntities" status="count">
				<li><a href="javascript:showSalary('${softGroupEntity.detailList}','${softGroupEntity.status}','${softGroupEntity.year}','${softGroupEntity.month}','${userDept}','${userName}')"><s:property value="#softGroupEntity.year"/>-<s:property value="#softGroupEntity.month"/></a> 
<%-- 					<c:if test="${softGroupEntity.status eq null or  softGroupEntity.status eq '' }"> --%>
<!-- 						(待确认)  -->
<%-- 						<a style="float:right" href="javascript:confirmRight(${softGroupEntity.id})">|确认无误</a> --%>
<%-- 						 <a style="float:right" href="javascript:tcyy(${softGroupEntity.id})">提出异议</a> --%>
<%-- 					</c:if>  --%>
<%-- 					<c:if test="${softGroupEntity.status eq 2}"> --%>
<!-- 						(已确认) -->
<%-- 					</c:if>  --%>
<%-- 					<c:if test="${softGroupEntity.status eq 1}"> --%>
<!-- 						(待人事重新审核) -->
<%-- 					</c:if>  --%>
				</li>
			</s:iterator>
			</c:if>
			</ul>
			</div>
			
			
			
			
			</div>
			<div class="blank20"></div>
        </div>
      </div>
    </div>
    
    <div class="modal fade bs-example-modal-lg" id="cheakModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
	  <div class="modal-dialog modal-md" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" style="text-align:center;font-weight:bold" id="exampleModalLabel"></h4><div class="container-fluid1"></div>
	      </div>
	      <div class="modal-body">
	      	<input type="hidden" id="groupDetailID" />
	      	<p id="ntcContent"></p>
	      	<div id="attachments"></div>
	      	<div>
	      	<hr>
	      	<h4>注：</h4>
	      	<p id="zhu">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;骑岸总部在门卫处领取；<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;南通分部在人事行政部领取；</p>
	      	</div>
	      
	      </div>
	      <div class="modal-footer">
	      <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
	      </div>
	    </div>
	  </div>
	</div>
</body>
</html>
